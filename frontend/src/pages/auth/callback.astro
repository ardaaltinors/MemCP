---
import Layout from "layouts/Layout.astro";
---

<Layout title="Signing in..." description="Completing OAuth sign-in">
  <main class="min-h-screen flex items-center justify-center px-4 py-12">
    <div class="text-center text-gray-200">
      <h1 class="text-xl font-semibold mb-2">Completing sign-inâ€¦</h1>
      <p class="text-gray-400">Please wait while we finalize your login.</p>
    </div>
  </main>
  <script>
    import { authUtils } from "@libs/utils/auth";

    // Parse fragment for token
    const hash = window.location.hash.startsWith('#') ? window.location.hash.substring(1) : '';
    const params = new URLSearchParams(hash);
    const access_token = params.get('access_token');
    const token_type = params.get('token_type') || 'bearer';
    const expires_at = params.get('expires_at') || new Date(Date.now() + 1000*60*60).toISOString();

    if (access_token) {
      authUtils.storeToken({ access_token, token_type, expires_at });
      // Clear fragment and redirect
      window.location.replace('/dashboard');
    } else {
      // No token, go back to login
      window.location.replace('/login');
    }
  </script>
</Layout>

<style>
  main { background: inherit; }
  .text-gray-200 { color: #e5e7eb; }
  .text-gray-400 { color: #9ca3af; }
</style>

